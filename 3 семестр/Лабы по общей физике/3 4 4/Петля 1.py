import numpy as np
import matplotlib.pyplot as plt

# Данные для начальной кривой намагничивания (восходящая ветвь)
H_asc = np.array([0, 85.78704441, 156.5335031, 217.8099634, 247.8911348,
                  311.841477, 372.0038198, 529.3172052, 875.9191469,
                  1395.042177, 2863.281872, 8121.359223])
dB_asc = np.array([0.06489018, 0.030282084, 0.025956072, 0.02163006, 0.025956072,
                   0.030282084, 0.060564168, 0.1081503, 0.147084408, 0.237930659, 0.242256671, 0])

# Вычисляем абсолютные значения B для восходящей ветви
B_asc = np.cumsum(dB_asc)

# Данные для нисходящей ветви петли гистерезиса
H_desc = np.array([0, 85.78704441, 156.5335031, 217.8099634, 247.8354289,
                   311.39583, 371.5581728, 528.6487347, 875.1392647,
                   1394.318001, 2861.610696, 8119.688047])
dB_desc = np.array([0, -0.012978036, -0.012978036, -0.012978036, -0.008652024,
                    -0.017304048, -0.012978036, -0.060564168, -0.138432384,
                    -0.168714468, -0.268212743, -0.255234707])

# Вычисляем абсолютные значения B для нисходящей ветви
B_desc = np.cumsum(dB_desc) + B_asc[-1]  # Начинаем с максимального значения B из восходящей ветви

# Создаем полную петлю гистерезиса, объединяя данные
H_full = np.concatenate((H_asc, -H_desc[1:]))  # Положительные и отрицательные значения H
B_full = np.concatenate((B_asc, B_desc[1:]))   # Соответствующие значения B

# Задаем погрешности
H_err = 20  # Погрешность H, А/м
B_err = 0.002  # Погрешность B, Тл

# Создаем график
plt.figure(figsize=(12, 8))

# Построение полной петли гистерезиса
plt.plot(H_full, B_full, 'b-', linewidth=2, label='Петля гистерезиса')

# Добавляем погрешности измерений
plt.errorbar(H_asc, B_asc, xerr=H_err, yerr=B_err, fmt='o', color='red', 
             label='Восходящая ветвь', capsize=3, markersize=4)
plt.errorbar(-H_desc, B_desc, xerr=H_err, yerr=B_err, fmt='s', color='green', 
             label='Нисходящая ветвь', capsize=3, markersize=4)

# Настройка графика
plt.xlabel('H, А/м', fontsize=12)
plt.ylabel('B, Тл', fontsize=12)
plt.title('Петля гистерезиса ферромагнетика', fontsize=14)
plt.legend(fontsize=12)
plt.grid(True, linestyle='--', alpha=0.7)

# # Добавляем стрелки для указания направления
# plt.annotate('', xy=(5000, 0.5), xytext=(6000, 0.5),
#              arrowprops=dict(arrowstyle='->', color='blue'))
# plt.annotate('', xy=(-5000, -0.5), xytext=(-6000, -0.5),
#              arrowprops=dict(arrowstyle='->', color='blue'))

# Добавляем подписи к критическим точкам
plt.text(0, B_asc[-1], 'B_s', fontsize=12, ha='center')
plt.text(1600, 0, 'H_c', fontsize=12, ha='center')

# Показать график
plt.tight_layout()
plt.show()